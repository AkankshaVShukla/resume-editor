<!doctype html>
<html>
	<head>
	
	<meta charset="utf-8">
	<title>resume-creator</title>
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.2.0/css/bootstrap.min.css">
	<link rel="stylesheet" href="css/style.css">
	
	</head>
	<body>
	
	<aside id="sidebar">
		<form id="form" action="">
		<div class="fields">
			<textarea id="resume"></textarea>
		</div>
		<div class="submit">
			<button type="submit">Update preview</button>
		</div>
		</form>
	</aside>
	<div id="preview">
		<iframe id="iframe"></iframe>
	</div>
	
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script>
	$(function() {
		var timer = null;
		var resume = $("#resume").on("input", function() {
			clearTimeout(timer);
			timer = setTimeout(function() {
				var post = true;
				try {
					JSON.parse(resume.val());
				} catch(e) {
					post = false;
				}
				if (post) {
					form.trigger("submit");
				}
			}, 250);
		});
		
		$.ajax({
			dataType: "text",
			url: "resume.json",
			success: function(json) {
				resume.html(json);
				form.trigger("submit");
			}
		});
		
		var form = $("#form");
		form.on("submit", function(e) {
			e.preventDefault();
			var data = JSON.stringify({
				resume: JSON.parse(resume.val())
			});
			$.ajax({
				type: "POST",
				url: "http://themes.jsonresume.org/theme/flat",
				contentType: "application/json",
				data: data,
				success: function(html) {
					$("#iframe").contents().find("body").html(html);
				}
			});
		});
	});
	</script>
	
	</body>
</html>
